---
title: "Process the Canadian samples"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Process the Canadian samples}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo = FALSE, message = FALSE, results = "hide", warning = FALSE}
library(hake)
```

**Note - simply rendering this vignette will build the files, and you don't
have to run anything. Check the timestamps of the files to verify.** \

   1. Open R and load the hake package: \
      ```{r}
      devtools::load_all()
      ```

   1. On the DFO network, or on a DFO computer with the VPN turned on, run
      the following to extract the newest data from the `GFBioSQL` database. \
      Choose any directory, the one shown here is an example: \
      ```{r echo = TRUE, eval = FALSE}
      canada_extract_samples_from_db(dr = "some/path/on/local/machine")
      ```
      This will create a file called `r can_sample_data_rds_fn` in the
      directory you chose for `dr`.
      
   1. Move or copy the file (`r can_sample_data_rds_fn`) you created to the
      server in the directory `/srv/hake/other/samples`.
      
   1. Run the following to load the sample data from the RDS file created
      above. Area and gear type filtering is also performed in this
      function. The default gear type is `midwater trawl` and the default
      areas are the west coast major areas plus the strait of Juan de Fuca: \
      ```{r echo = TRUE}
      sample_df <- canada_load_sample_data()
      ```

   1. Run the following to break the `sample_df` data frame created above
      into smaller data frames representing the three Canadian fleets
      (Freezer trawlers, Shoreside, and Joint venture): \
      ```{r echo = TRUE}
      samples_fleet_lst <- canada_get_fleet_samples(sample_df)
      ```
   1. Run the following to create (overwrite) the Canadian age proportions
      by fleet files (Freezer trawlers, Shoreside, and Joint venture).
      These proportions are weighted by sample weight and catch weight,
      and use a length/weight model to estimate parameters used to generate
      individual specimen weights from records with only length data: \
      ```{r echo = TRUE}
      canada_create_age_proportions_csv(samples_fleet_lst$ft, type = "ft")
      canada_create_age_proportions_csv(samples_fleet_lst$ss, type = "ss")
      canada_create_age_proportions_csv(samples_fleet_lst$jv, type = "jv")
      ```

   1. Run the following to create (overwrite) the raw Canadian age proportions
      by fleet files (Freezer trawlers, Shoreside, and Joint venture).
      These proportions are not weighted and do not contain weights calculated
      by using a length/weight model: \
      ```{r echo = TRUE}
      canada_create_age_proportions_csv(samples_fleet_lst$ft,
                                        type = "ft",
                                        raw_proportions = TRUE)
      canada_create_age_proportions_csv(samples_fleet_lst$ss,
                                        type = "ss",
                                        raw_proportions = TRUE)
      canada_create_age_proportions_csv(samples_fleet_lst$jv,
                                        type = "jv",
                                        raw_proportions = TRUE)
      ```
   1. Create the Canadian weight-at-age CSV file:
      ```{r echo = TRUE}
      canada_create_commercial_waa(sample_df)
      ```   
      