---
title: "Process the Canadian samples"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Process the Canadian samples}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo = FALSE, message = FALSE, results = "hide", warning = FALSE}
library(hake)
```

**Note - simply compiling this vignette will build the files, and you can
just skip to #4. Check the timestamps of the files to verify.** \

   1. Open R and load the hake package: \
      ```{r}
      devtools::load_all()
      ```

   1. On the DFO network, or on a DFO computer with the VPN turned on, run
      the following to extract the newest data from the `GFBioSQL` database. \
      Choose any directory, the one shown here is an example: \
      ```{r echo = TRUE, eval = FALSE}
      canada_extract_samples_from_db(dr = "/srv/hake/other/samples")
      ```
      This will create a file called `r can_sample_data_rds_fn` in the
      directory you chose.
      
   1. Move or copy the file (`r can_sample_data_rds_fn`) you created to the
      server in the directory `/srv/hake/other/samples`.
      
   1. Run the following to create (overwrite) the Canadian XXXX file
      (note the directory `dr` which contains the files created above): \
      ```{r echo = TRUE}
      sample_df <- canada_load_sample_data()
      samples_fleet_lst <- canada_get_fleet_samples(sample_df)
      ```

   1. Run the following to generate aggregated (all fleets) age proportions, \
      weighted by sample weight and catch weight: \
      ```{r echo = TRUE}
      ap <- canada_get_age_proportions(sample_df)
      ```

   1. Run the following to generate the age proportions by fleet (Freezer
      trawlers, Shoreside, and Joint venture): \
      ```{r echo = TRUE}
      ft_ap <- canada_get_age_proportions(samples_fleet_lst$ft)
      
      ss_ap <- canada_get_age_proportions(samples_fleet_lst$ss)
      
      jv_ap <- canada_get_age_proportions(samples_fleet_lst$jv)
      ```
